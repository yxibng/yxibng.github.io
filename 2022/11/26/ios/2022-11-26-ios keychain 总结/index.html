

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="yxibng">
  <meta name="keywords" content="">
  
    <meta name="description" content="Keychain  是什么一个加密的数据库， 可以用来存储小的用户数据， 包括  kSecClassGenericPassword：通用密码（可以用来存自定义数据） kSecClassInternetPassword：互联网密码 kSecClassCertificate：证书 kSecClassKey：秘钥 kSecClassIdentity：证书+秘钥  Figure 1 Securing th">
<meta property="og:type" content="article">
<meta property="og:title" content="ios keychain 总结">
<meta property="og:url" content="https://yxibng.github.io/2022/11/26/ios/2022-11-26-ios%20keychain%20%E6%80%BB%E7%BB%93/index.html">
<meta property="og:site_name" content="yxibng">
<meta property="og:description" content="Keychain  是什么一个加密的数据库， 可以用来存储小的用户数据， 包括  kSecClassGenericPassword：通用密码（可以用来存自定义数据） kSecClassInternetPassword：互联网密码 kSecClassCertificate：证书 kSecClassKey：秘钥 kSecClassIdentity：证书+秘钥  Figure 1 Securing th">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://fastly.jsdelivr.net/gh/yxibng/filebed@main/img/images/blog/16692950150511669295014987.png">
<meta property="og:image" content="https://fastly.jsdelivr.net/gh/yxibng/filebed@main/img/images/blog/16694375672261669437566402.png">
<meta property="og:image" content="https://fastly.jsdelivr.net/gh/yxibng/filebed@main/img/images/blog/16692963470741669296346746.png">
<meta property="og:image" content="https://fastly.jsdelivr.net/gh/yxibng/filebed@main/img/images/blog/16694538450341669453844996.png">
<meta property="og:image" content="https://fastly.jsdelivr.net/gh/yxibng/filebed@main/img/images/blog/16694538730181669453872352.png">
<meta property="article:published_time" content="2022-11-25T16:00:00.000Z">
<meta property="article:modified_time" content="2024-03-06T11:53:13.567Z">
<meta property="article:author" content="yxibng">
<meta property="article:tag" content="iOS">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://fastly.jsdelivr.net/gh/yxibng/filebed@main/img/images/blog/16692950150511669295014987.png">
  
  
  
  <title>ios keychain 总结 - yxibng</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"yxibng.github.io","root":"/","version":"1.9.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.1.1"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>yxibng</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="ios keychain 总结"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2022-11-26 00:00" pubdate>
          2022年11月26日 凌晨
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          1.8k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          16 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">ios keychain 总结</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="Keychain-是什么"><a href="#Keychain-是什么" class="headerlink" title="Keychain  是什么"></a>Keychain  是什么</h1><p>一个加密的数据库， 可以用来存储小的用户数据， 包括</p>
<ul>
<li>kSecClassGenericPassword：通用密码（可以用来存自定义数据）</li>
<li>kSecClassInternetPassword：互联网密码</li>
<li>kSecClassCertificate：证书</li>
<li>kSecClassKey：秘钥</li>
<li>kSecClassIdentity：证书+秘钥</li>
</ul>
<p><img src="https://fastly.jsdelivr.net/gh/yxibng/filebed@main/img/images/blog/16692950150511669295014987.png" srcset="/img/loading.gif" lazyload><br>Figure 1 Securing the user’s secrets in a keychain</p>
<p>打开 mac 系统的 keychain 观察一下， 发现系统有多个keychain，每个keychain都有上图对应的项目<br><img src="https://fastly.jsdelivr.net/gh/yxibng/filebed@main/img/images/blog/16694375672261669437566402.png" srcset="/img/loading.gif" lazyload></p>
<h1 id="如何管理数据，增删查改"><a href="#如何管理数据，增删查改" class="headerlink" title="如何管理数据，增删查改"></a>如何管理数据，增删查改</h1><p><img src="https://fastly.jsdelivr.net/gh/yxibng/filebed@main/img/images/blog/16692963470741669296346746.png" srcset="/img/loading.gif" lazyload><br>Figure 1 Putting data and attributes into a keychain</p>
<p>keychain 将要存储的数据封装为 SecKeychainItemRef，通过存取 SecKeychainItem 来达到对数据的管理。</p>
<p>SecKeychainItemRef 包含</p>
<ul>
<li>data， CFData， 要存取的数据</li>
<li>attributes, 该条目的属性，存取权限，查询标签等</li>
</ul>
<p>提供的api</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-comment">//添加</span><br>OSStatus <span class="hljs-built_in">SecItemAdd</span>(CFDictionaryRef attributes, CFTypeRef  _Nullable *result);<br><span class="hljs-comment">//查询</span><br>OSStatus <span class="hljs-built_in">SecItemCopyMatching</span>(CFDictionaryRef query, CFTypeRef  _Nullable *result);<br><span class="hljs-comment">//更新</span><br>OSStatus <span class="hljs-built_in">SecItemUpdate</span>(CFDictionaryRef query, CFDictionaryRef attributesToUpdate);<br><span class="hljs-comment">//删除</span><br>OSStatus <span class="hljs-built_in">SecItemDelete</span>(CFDictionaryRef query);<br><br></code></pre></td></tr></table></figure>

<h2 id="SecItemAdd"><a href="#SecItemAdd" class="headerlink" title="SecItemAdd"></a>SecItemAdd</h2><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs objectivec">OSStatus SecItemAdd(<span class="hljs-built_in">CFDictionaryRef</span> attributes, <span class="hljs-built_in">CFTypeRef</span>  _Nullable *result);<br></code></pre></td></tr></table></figure>

<h3 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h3><p><strong>attributes</strong></p>
<p>一个字典，描述要添加的数据：</p>
<ul>
<li>要添加数据类型，对应的 key 为<code>kSecClass</code>, value 可以是<ul>
<li>kSecClassGenericPassword：通用密码（可以用来存自定义数据）</li>
<li>kSecClassInternetPassword：互联网密码</li>
<li>kSecClassCertificate：证书</li>
<li>kSecClassKey：秘钥</li>
<li>kSecClassIdentity：证书+秘钥</li>
</ul>
</li>
<li>数添加的数据本身, key 为 <code> kSecValueData</code>, value 为 <code>CFDataRef</code> 类型</li>
<li>关联的属性, 参考：<a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/security/keychain_services/keychain_items/item_attribute_keys_and_values?language=objc">Item Attribute Keys and Values</a><ul>
<li>每种类型关联的属性可以不同，例如 kSecClassInternetPassword 可以关联 <code>kSecAttrServer</code>, <code>kSecAttrPort</code>, <code>kSecAttrProtocol</code>， 而 <code>kSecClassGenericPassword</code>就没有这些选项</li>
<li><code>kSecAttrAccessGroup</code> 可以指定存入的keychain group，这个会影响到查询范围</li>
</ul>
</li>
<li>添加后，返回添加结果的类型，指定类型的数据会存入 result 字段。参考：<a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/security/keychain_services/keychain_items/item_return_result_keys?language=objc"> Item Return Result Keys</a></li>
</ul>
<p><strong>result</strong></p>
<p>添加结束，函数返回，指向新添加的条目。根据 attributes 中指定的类型，返回对应的值。参考： <a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/security/keychain_services/keychain_items/item_return_result_keys?language=objc"> Item Return Result Keys</a></p>
<p>一般添加不关心新条目，传nil</p>
<h3 id="返回值"><a href="#返回值" class="headerlink" title="返回值"></a>返回值</h3><p>成功或者错误码。参考：<a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/security/1542001-security_framework_result_codes?language=objc">Security Framework Result Codes</a></p>
<h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><ol>
<li>kSecAttrAccessGroup 可以指定添加到 钥匙串分组，该分组中的成员共享该条目</li>
<li>一次添加多条，可以使用<code>kSecUseItemList </code>传入字典数组，但是不能用于密码类型</li>
<li>添加是同步执行，放到主线程可能会卡界面，可以用异步方式</li>
</ol>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs scss">- (void)addKeychainItemWithAttributes:(CFDictionaryRef)attrs completion:(<span class="hljs-built_in">void</span>(^)(OSStatus status, CFTypeRef item))completion &#123;<br>    <span class="hljs-built_in">dispatch_async</span>(backgroundQueue, ^&#123;<br>        CFTypeRef item = NULL;<br>        OSStatus addResult = SecItemAdd(attrs, &amp;item);<br>        <span class="hljs-built_in">completion</span>(addResult, item);<br>        if (item) &#123;<br>            <span class="hljs-built_in">CFRelease</span>(item);<br>        &#125;<br>    &#125;);<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="SecItemCopyMatching"><a href="#SecItemCopyMatching" class="headerlink" title="SecItemCopyMatching"></a>SecItemCopyMatching</h2><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs objectivec">OSStatus SecItemCopyMatching(<span class="hljs-built_in">CFDictionaryRef</span> query, <span class="hljs-built_in">CFTypeRef</span>  _Nullable *result);<br></code></pre></td></tr></table></figure>

<p>通过 query 指定查询条件，将查询结果存入 result 中。</p>
<h3 id="参数-1"><a href="#参数-1" class="headerlink" title="参数"></a>参数</h3><p><strong>query</strong><br>用于指定查询条件</p>
<ul>
<li>查询的数据类型，通过 <code>kSecClass</code> 指定</li>
<li>关联的属性， 用于缩小查询范围</li>
<li>查询参数，返回一条还是多条匹配项，是否大消息敏感，或者从特定项中搜索。参考： <a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/security/keychain_services/keychain_items/search_attribute_keys_and_values?language=objc"> Search Attribute Keys and Values</a></li>
<li>指定返回类型，指定的类型不同，result 中返回的类型就不同。 参考： <a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/security/keychain_services/keychain_items/item_return_result_keys?language=objc">Item Return Result Keys </a></li>
</ul>
<p>**result **</p>
<p>保存查询结果。<br>例如： 指定  <code>kSecReturnData: kCFBooleanTrue</code>  ，result 中存的就是<code>CFDataRef </code>类型的数据。参考： <a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/security/keychain_services/keychain_items/item_return_result_keys?language=objc">Item Return Result Keys</a></p>
<h3 id="返回值-1"><a href="#返回值-1" class="headerlink" title="返回值"></a>返回值</h3><p>成功或者错误码。参考：<a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/security/1542001-security_framework_result_codes?language=objc">Security Framework Result Codes</a></p>
<h3 id="注意-1"><a href="#注意-1" class="headerlink" title="注意"></a>注意</h3><ol>
<li>默认返回第一个匹配项，如果想查询多条匹配，指定 <code>kSecMatchLimit</code>  大于1， 此时 result 为 <code>CFArrayRef</code>  类型</li>
<li>当类型为<code>kSecInternetPasswordItemClass</code> 或 <code>kSecGenericPasswordItemClass</code>时， 不能同时指定<code>kSecReturnData</code> 和 <code>kSecMatchLimitAll</code>, 原因是拷贝每个密码时，需要额外的授权验证。</li>
<li>默认情况下，会搜索当前keychain 以及所有加入的 keychain group， 通过 <code>kSecAttrAccessGroup</code> 可以指定要在哪个 keychain group 查询</li>
<li>主线程同步执行会卡UI， 可以异步执行</li>
</ol>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs objectivec">- (<span class="hljs-type">void</span>)findKeychainItemWithAttributes:(<span class="hljs-built_in">NSDictionary</span> *)attributes completion:(<span class="hljs-type">void</span>(^)(OSStatus status, <span class="hljs-built_in">CFTypeRef</span> item))completion &#123;<br>    <span class="hljs-built_in">dispatch_async</span>(backgroundQueue, ^&#123;<br>        <span class="hljs-built_in">CFDictionaryRef</span> attrs = (__bridge <span class="hljs-built_in">CFDictionaryRef</span>)attributes;<br>        <span class="hljs-built_in">CFTypeRef</span> item = <span class="hljs-literal">NULL</span>;<br>        OSStatus result = SecItemCopyMatching(attrs, &amp;item);<br>        completion(result, item);<br>        <span class="hljs-built_in">CFRelease</span>(item);<br>    &#125;);<br>&#125;<br></code></pre></td></tr></table></figure>


<h2 id="SecItemUpdate"><a href="#SecItemUpdate" class="headerlink" title="SecItemUpdate"></a>SecItemUpdate</h2><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs objectivec">OSStatus SecItemUpdate(<span class="hljs-built_in">CFDictionaryRef</span> query, <span class="hljs-built_in">CFDictionaryRef</span> attributesToUpdate);<br></code></pre></td></tr></table></figure>

<h3 id="参数-2"><a href="#参数-2" class="headerlink" title="参数"></a>参数</h3><p><strong>query</strong></p>
<p>用来指定要更新的条目, 执行更新，需要先查询到要更新的条目。<br>参考 SecItemCopyMatching 如何指定查询条件。</p>
<p><strong>attributesToUpdate</strong></p>
<p>指定需要更新的属性。</p>
<h3 id="返回值-2"><a href="#返回值-2" class="headerlink" title="返回值"></a>返回值</h3><p>成功或者错误码。参考：<a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/security/1542001-security_framework_result_codes?language=objc">Security Framework Result Codes</a></p>
<h3 id="注意-2"><a href="#注意-2" class="headerlink" title="注意"></a>注意</h3><p>主线程同步执行会卡UI， 可以异步执行</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs scss">- (void)updateKeyChainItemWithAttributes:(CFDictionaryRef)attrs update:(CFDictionaryRef)update completion:(<span class="hljs-built_in">void</span>(^)(OSStatus status))completion &#123;<br>    <span class="hljs-built_in">dispatch_async</span>(backgroundQueue, ^&#123;<br>        OSStatus updateResult = SecItemUpdate(attrs, update);<br>        <span class="hljs-built_in">completion</span>(updateResult);<br>    &#125;);<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="SecItemDelete"><a href="#SecItemDelete" class="headerlink" title="SecItemDelete"></a>SecItemDelete</h2><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">OSStatus <span class="hljs-built_in">SecItemDelete</span>(CFDictionaryRef query);<br></code></pre></td></tr></table></figure>

<h3 id="参数-3"><a href="#参数-3" class="headerlink" title="参数"></a>参数</h3><p><strong>query</strong></p>
<p>用来指定要删除的的条目， 参考SecItemCopyMatching 如何指定查询条件。</p>
<h3 id="返回值-3"><a href="#返回值-3" class="headerlink" title="返回值"></a>返回值</h3><p>成功或者错误码。参考：<a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/security/1542001-security_framework_result_codes?language=objc">Security Framework Result Codes</a></p>
<h3 id="注意-3"><a href="#注意-3" class="headerlink" title="注意"></a>注意</h3><ol>
<li>默认删除所有的匹配项，</li>
<li>可以通过指定<code>kSecMatchItemList </code>来限定删除范围， <code>kSecMatchItemList</code>对应的值的类型为<code>CFArrayRef </code>, 数组中每一项的类型必须相同，<ul>
<li>针对临时引用，每一项是一个引用，引用的类型可以是<ul>
<li>SecKeychainItemRef,</li>
<li>SecKeyRef</li>
<li>SecCertificateRef</li>
<li>SecIdentityRef</li>
<li>CFDataRef</li>
</ul>
</li>
<li>针对持久化引用, 引用的必须是类型是 <code>CFDataRef</code></li>
</ul>
</li>
<li>主线程同步执行会卡UI， 可以异步执行</li>
</ol>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs scss">- (void)deleteKeychainItemWithAttributes:(CFDictionaryRef)attrs completion:(<span class="hljs-built_in">void</span>(^)(OSStatus status))completion &#123;<br>    <span class="hljs-built_in">dispatch_async</span>(backgroundQueue, ^&#123;<br>        OSStatus deleteResult = SecItemDelete(attrs);<br>        <span class="hljs-built_in">completion</span>(deleteResult);<br>    &#125;);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="什么是临时引用，持久化引用又是什么？"><a href="#什么是临时引用，持久化引用又是什么？" class="headerlink" title="什么是临时引用，持久化引用又是什么？"></a>什么是临时引用，持久化引用又是什么？</h3><p><strong>临时引用</strong></p>
<p>对应的 key  值是<code>kSecReturnRef</code></p>
<blockquote>
<p>The corresponding value is of type <code>CFBooleanRef</code>. A value of <code>kCFBooleanTrue</code> indicates that a reference should be returned. Depending on the item class requested, the returned references may be of type <code>SecKeychainItemRef</code>, <code>SecKeyRef</code>, <code>SecCertificateRef</code>, <code>SecIdentityRef</code>, or <code>CFDataRef</code>.</p>
</blockquote>
<p>示例 ：SecCertificateRef 证书对象的引用在keychain中存取</p>
<p>创建SecCertificateRef</p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs gcode">SecCertificateRef certificate =<br>    SecCertificateCreateWithData<span class="hljs-comment">(NULL, (__bridge CFDataRef)</span>certData);<br>		 <br><span class="hljs-keyword">if</span> <span class="hljs-comment">(certificate)</span>  &#123; CFRelease<span class="hljs-comment">(certificate)</span>; &#125; <span class="hljs-comment">// After you are done with it</span><br></code></pre></td></tr></table></figure>

<p>将证书存入keychain</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs fsharp">NSDictionary<span class="hljs-operator">*</span> addquery <span class="hljs-operator">=</span> <span class="hljs-operator">@</span>&#123; (<span class="hljs-built_in">id</span>)kSecValueRef<span class="hljs-operator">:</span>   (__bridge <span class="hljs-built_in">id</span>)certificate,<br>                            (<span class="hljs-built_in">id</span>)kSecClass<span class="hljs-operator">:</span>      (<span class="hljs-built_in">id</span>)kSecClassCertificate,<br>                            (<span class="hljs-built_in">id</span>)kSecAttrLabel<span class="hljs-operator">:</span>  <span class="hljs-string">@&quot;My Certificate&quot;</span>,<br>                           &#125;;<br>						   <br>						   <br>OSStatus status <span class="hljs-operator">=</span> SecItemAdd((__bridge CFDictionaryRef)addquery, NULL);<br><span class="hljs-keyword">if</span> (status <span class="hljs-operator">!=</span> errSecSuccess) &#123;<br>    <span class="hljs-comment">// Handle the error</span><br>&#125;						   <br></code></pre></td></tr></table></figure>

<p>从keychain读取证书</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-built_in">NSDictionary</span> *getquery = @&#123; (<span class="hljs-type">id</span>)kSecClass:     (<span class="hljs-type">id</span>)kSecClassCertificate,<br>                            (<span class="hljs-type">id</span>)kSecAttrLabel: <span class="hljs-string">@&quot;My Certificate&quot;</span>,<br>                            (<span class="hljs-type">id</span>)kSecReturnRef: @YES,<br>                            &#125;;<br>SecCertificateRef certificate = <span class="hljs-literal">NULL</span>;<br>OSStatus status = SecItemCopyMatching((__bridge <span class="hljs-built_in">CFDictionaryRef</span>)getquery,<br>                                      (<span class="hljs-built_in">CFTypeRef</span> *)&amp;certificate);<br><span class="hljs-keyword">if</span> (status != errSecSuccess) &#123; &lt;# Handle error #&gt; &#125;<br><span class="hljs-keyword">else</span>                         &#123; &lt;# Use certificate #&gt; &#125;<br> <br><span class="hljs-keyword">if</span> (certificate) &#123; <span class="hljs-built_in">CFRelease</span>(certificate); &#125; <span class="hljs-comment">// After you are done with it</span><br></code></pre></td></tr></table></figure>

<p>观察到这里用的就是 <code>kSecReturnRef</code>, 代表临时引用。</p>
<ul>
<li>SecKeychainItemRef,</li>
<li>SecKeyRef</li>
<li>SecCertificateRef</li>
<li>SecIdentityRef</li>
<li>CFDataRef</li>
</ul>
<p><strong>持久化引用</strong></p>
<p>key 为 kSecReturnPersistentRef。</p>
<blockquote>
<p>The corresponding value is of type <code>CFBooleanRef</code>. A value of kCFBooleanTrue indicates that a persistent reference to an item should be returned as a <code>CFDataRef</code> object. Unlike normal references, a persistent reference may be stored on disk or passed between processes.</p>
</blockquote>
<ol>
<li>一个持久化引用，引用的对象必须是<code>CFDataRef</code></li>
<li>持久化引用可以存储在磁盘，可以跨进程传递</li>
</ol>
<h1 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h1><h2 id="Adding-a-Password-to-the-Keychain"><a href="#Adding-a-Password-to-the-Keychain" class="headerlink" title="Adding a Password to the Keychain"></a><a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/security/keychain_services/keychain_items/adding_a_password_to_the_keychain?language=objc">Adding a Password to the Keychain</a></h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs typescript">struct <span class="hljs-title class_">Credentials</span> &#123;<br>    <span class="hljs-keyword">var</span> <span class="hljs-attr">username</span>: <span class="hljs-title class_">String</span><br>    <span class="hljs-keyword">var</span> <span class="hljs-attr">password</span>: <span class="hljs-title class_">String</span><br>&#125;<br><br><span class="hljs-keyword">enum</span> <span class="hljs-title class_">KeychainError</span>: <span class="hljs-title class_">Error</span> &#123;<br>    <span class="hljs-keyword">case</span> noPassword<br>    <span class="hljs-keyword">case</span> unexpectedPasswordData<br>    <span class="hljs-keyword">case</span> <span class="hljs-title function_">unhandledError</span>(<span class="hljs-attr">status</span>: <span class="hljs-title class_">OSStatus</span>)<br>&#125;<br><br><span class="hljs-keyword">static</span> <span class="hljs-keyword">let</span> server = <span class="hljs-string">&quot;www.example.com&quot;</span><br><br><span class="hljs-keyword">let</span> account = credentials.<span class="hljs-property">username</span><br><span class="hljs-keyword">let</span> password = credentials.<span class="hljs-property">password</span>.<span class="hljs-title function_">data</span>(<span class="hljs-attr">using</span>: <span class="hljs-title class_">String</span>.<span class="hljs-property">Encoding</span>.<span class="hljs-property">utf8</span>)!<br><span class="hljs-keyword">var</span> <span class="hljs-attr">query</span>: [<span class="hljs-title class_">String</span>: <span class="hljs-title class_">Any</span>] = [kSecClass <span class="hljs-keyword">as</span> <span class="hljs-title class_">String</span>: kSecClassInternetPassword,<br>                            kSecAttrAccount <span class="hljs-keyword">as</span> <span class="hljs-title class_">String</span>: account,<br>                            kSecAttrServer <span class="hljs-keyword">as</span> <span class="hljs-title class_">String</span>: server,<br>                            kSecValueData <span class="hljs-keyword">as</span> <span class="hljs-title class_">String</span>: password]<br><span class="hljs-keyword">let</span> status = <span class="hljs-title class_">SecItemAdd</span>(query <span class="hljs-keyword">as</span> <span class="hljs-title class_">CFDictionary</span>, nil)<br>guard status == errSecSuccess <span class="hljs-keyword">else</span> &#123; <span class="hljs-keyword">throw</span> <span class="hljs-title class_">KeychainError</span>.<span class="hljs-title function_">unhandledError</span>(<span class="hljs-attr">status</span>: status) &#125;<br><br></code></pre></td></tr></table></figure>

<h2 id="Searching-for-Keychain-Items"><a href="#Searching-for-Keychain-Items" class="headerlink" title="Searching for Keychain Items"></a><a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/security/keychain_services/keychain_items/searching_for_keychain_items?language=objc">Searching for Keychain Items</a></h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs swift"><span class="hljs-keyword">let</span> query: [<span class="hljs-type">String</span>: <span class="hljs-keyword">Any</span>] <span class="hljs-operator">=</span> [kSecClass <span class="hljs-keyword">as</span> <span class="hljs-type">String</span>: kSecClassInternetPassword,<br>                            kSecAttrServer <span class="hljs-keyword">as</span> <span class="hljs-type">String</span>: server,<br>                            kSecMatchLimit <span class="hljs-keyword">as</span> <span class="hljs-type">String</span>: kSecMatchLimitOne,<br>                            kSecReturnAttributes <span class="hljs-keyword">as</span> <span class="hljs-type">String</span>: <span class="hljs-literal">true</span>,<br>                            kSecReturnData <span class="hljs-keyword">as</span> <span class="hljs-type">String</span>: <span class="hljs-literal">true</span>]<br><br><span class="hljs-keyword">var</span> item: <span class="hljs-type">CFTypeRef</span>?<br><span class="hljs-keyword">let</span> status <span class="hljs-operator">=</span> <span class="hljs-type">SecItemCopyMatching</span>(query <span class="hljs-keyword">as</span> <span class="hljs-type">CFDictionary</span>, <span class="hljs-operator">&amp;</span>item)<br><span class="hljs-keyword">guard</span> status <span class="hljs-operator">!=</span> errSecItemNotFound <span class="hljs-keyword">else</span> &#123; <span class="hljs-keyword">throw</span> <span class="hljs-type">KeychainError</span>.noPassword &#125;<br><span class="hljs-keyword">guard</span> status <span class="hljs-operator">==</span> errSecSuccess <span class="hljs-keyword">else</span> &#123; <span class="hljs-keyword">throw</span> <span class="hljs-type">KeychainError</span>.unhandledError(status: status) &#125;<br><br><span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> existingItem <span class="hljs-operator">=</span> item <span class="hljs-keyword">as?</span> [<span class="hljs-type">String</span> : <span class="hljs-keyword">Any</span>],<br>    <span class="hljs-keyword">let</span> passwordData <span class="hljs-operator">=</span> existingItem[kSecValueData <span class="hljs-keyword">as</span> <span class="hljs-type">String</span>] <span class="hljs-keyword">as?</span> <span class="hljs-type">Data</span>,<br>    <span class="hljs-keyword">let</span> password <span class="hljs-operator">=</span> <span class="hljs-type">String</span>(data: passwordData, encoding: <span class="hljs-type">String</span>.<span class="hljs-type">Encoding</span>.utf8),<br>    <span class="hljs-keyword">let</span> account <span class="hljs-operator">=</span> existingItem[kSecAttrAccount <span class="hljs-keyword">as</span> <span class="hljs-type">String</span>] <span class="hljs-keyword">as?</span> <span class="hljs-type">String</span><br><span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-type">KeychainError</span>.unexpectedPasswordData<br>&#125;<br><span class="hljs-keyword">let</span> credentials <span class="hljs-operator">=</span> <span class="hljs-type">Credentials</span>(username: account, password: password)<br><br></code></pre></td></tr></table></figure>

<h2 id="Updating-and-Deleting-Keychain-Items"><a href="#Updating-and-Deleting-Keychain-Items" class="headerlink" title="Updating and Deleting Keychain Items"></a><a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/security/keychain_services/keychain_items/updating_and_deleting_keychain_items?language=objc">Updating and Deleting Keychain Items</a></h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs swift"><span class="hljs-keyword">let</span> query: [<span class="hljs-type">String</span>: <span class="hljs-keyword">Any</span>] <span class="hljs-operator">=</span> [kSecClass <span class="hljs-keyword">as</span> <span class="hljs-type">String</span>: kSecClassInternetPassword,<br>                            kSecAttrServer <span class="hljs-keyword">as</span> <span class="hljs-type">String</span>: server]<br>							<br><span class="hljs-keyword">let</span> account <span class="hljs-operator">=</span> credentials.username<br><span class="hljs-keyword">let</span> password <span class="hljs-operator">=</span> credentials.password.data(using: <span class="hljs-type">String</span>.<span class="hljs-type">Encoding</span>.utf8)<span class="hljs-operator">!</span><br><span class="hljs-keyword">let</span> attributes: [<span class="hljs-type">String</span>: <span class="hljs-keyword">Any</span>] <span class="hljs-operator">=</span> [kSecAttrAccount <span class="hljs-keyword">as</span> <span class="hljs-type">String</span>: account,<br>                                 kSecValueData <span class="hljs-keyword">as</span> <span class="hljs-type">String</span>: password]<br><br><span class="hljs-comment">//update								 								 </span><br><span class="hljs-keyword">let</span> status <span class="hljs-operator">=</span> <span class="hljs-type">SecItemUpdate</span>(query <span class="hljs-keyword">as</span> <span class="hljs-type">CFDictionary</span>, attributes <span class="hljs-keyword">as</span> <span class="hljs-type">CFDictionary</span>)<br><span class="hljs-keyword">guard</span> status <span class="hljs-operator">!=</span> errSecItemNotFound <span class="hljs-keyword">else</span> &#123; <span class="hljs-keyword">throw</span> <span class="hljs-type">KeychainError</span>.noPassword &#125;<br><span class="hljs-keyword">guard</span> status <span class="hljs-operator">==</span> errSecSuccess <span class="hljs-keyword">else</span> &#123; <span class="hljs-keyword">throw</span> <span class="hljs-type">KeychainError</span>.unhandledError(status: status) &#125;	<br><br><span class="hljs-comment">//delete</span><br><span class="hljs-keyword">let</span> status <span class="hljs-operator">=</span> <span class="hljs-type">SecItemDelete</span>(query <span class="hljs-keyword">as</span> <span class="hljs-type">CFDictionary</span>)<br><span class="hljs-keyword">guard</span> status <span class="hljs-operator">==</span> errSecSuccess <span class="hljs-operator">||</span> status <span class="hljs-operator">==</span> errSecItemNotFound <span class="hljs-keyword">else</span> &#123; <span class="hljs-keyword">throw</span> <span class="hljs-type">KeychainError</span>.unhandledError(status: status) &#125;<br></code></pre></td></tr></table></figure>

<h1 id="keychain-group-app-group"><a href="#keychain-group-app-group" class="headerlink" title="keychain group &amp; app group"></a>keychain group &amp; app group</h1><p>参考：<a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/security/keychain_services/keychain_items/sharing_access_to_keychain_items_among_a_collection_of_apps?language=objc">Sharing Access to Keychain Items Among a Collection of Apps</a></p>
<blockquote>
<p>Enable apps to share keychain items with each other by adding the apps to an access group.</p>
</blockquote>
<p>通过keychain group 可以在 app 间共享keychain item。</p>
<blockquote>
<p>An access group is a logical collection of apps tagged with a particular group name string. Any app in a given group can share keychain items with all the other apps in the same group. You can add an app to any number of groups, but the app is always part of at least one group that contains only itself. That is, an app can always store and retrieve private keychain items, regardless of whether it also participates in any other groups. Keychain items, on the other hand, are always part of exactly one group.</p>
</blockquote>
<p>默认情况下，app 加入了以自身id 为标记的分组中，这个分组中的所有 keychain item 仅限app 自身访问。</p>
<p>通过加入其他分组，app 间可以通过 keychain group 共享 keychain item。</p>
<h2 id="keychain-group-类型"><a href="#keychain-group-类型" class="headerlink" title="keychain group 类型"></a>keychain group 类型</h2><p>You control the groups that your app belongs to by manipulating its entitlements. In particular, an app belongs to all the groups named in a virtual array of strings that the system forms for each app as the concatenation of the following items, evaluated in this order:</p>
<p><strong>Keychain access groups</strong><br>The optional Keychain Access Groups Entitlement holds an array of strings, each of which names an access group.</p>
<p>显示指定加入的 keychain group， group id为 <code>[$(teamID).$(keychain group id)]</code></p>
<p><strong>Application identifier</strong><br>Xcode automatically adds the application-identifier entitlement (or the com.apple.application-identifier entitlement in macOS) to every app during code signing, formed as the team identifier (team ID) plus the bundle identifier (bundle ID).</p>
<p>隐式的加入了以自身为组的 keychain group,  group id为 <code>[$(teamID).$(bundle ID)]</code></p>
<p><strong>Application groups</strong><br>When you collect related apps into an application group using the App Groups Entitlement, they share access to a group container, and gain the ability to message each other in certain ways. Starting in iOS 8, the array of strings given by this entitlement also extends the list of keychain access groups.</p>
<p>由于加入了app group， 隐式的加入了以 app group 为组的 keychain group,  group id为 <code>[$(app group id)]</code></p>
<p>Xcode handles the application identifier (app ID) for you when you set the bundle ID. You set the others by manipulating capabilities in Xcode.</p>
<p>添加keychain group 和 app group 可以在xcode 中通过操作capabilities来实现。<br><img src="https://fastly.jsdelivr.net/gh/yxibng/filebed@main/img/images/blog/16694538450341669453844996.png" srcset="/img/loading.gif" lazyload><br><img src="https://fastly.jsdelivr.net/gh/yxibng/filebed@main/img/images/blog/16694538730181669453872352.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="app-group-和-keychain-group-区别"><a href="#app-group-和-keychain-group-区别" class="headerlink" title="app group 和 keychain group 区别"></a>app group 和 keychain group 区别</h2><p>App groups and keychain access groups aren’t mutually exclusive—you can use both in the same app—but they do differ in several important ways that may help you decide which to use for a given situation.</p>
<p>两者不是互相排斥的， 一个app可以同时加入keychain group 和 app group。</p>
<p>First, as described above, using an app group enables additional data sharing beyond keychain items. You might want this extra sharing, or might already be using an app group for this purpose, and thus not need to add keychain access groups. On the other hand, you might not want to enable this additional sharing at all, and prefer keychain access groups instead.</p>
<p>app group 除了共享 keychain item 之外，还能共享其他内容，例如共享偏好设置</p>
<figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pf">let <span class="hljs-keyword">user</span>Defualts = UserDefaults.init(suiteName: <span class="hljs-string">&quot;$(group_Id)&quot;</span>)<br><span class="hljs-keyword">user</span>Defualts?.<span class="hljs-built_in">set</span>Value(data, <span class="hljs-keyword">for</span>Key: key)<br><span class="hljs-keyword">user</span>Defualts?.synchronize()<br></code></pre></td></tr></table></figure>


<p>Second, order matters. The system considers the first item in the list of access groups to be the app’s default access group. This is the access group that keychain services assumes if you don’t otherwise specify one when adding keychain items. An app group can’t ever be the default, because the app ID is always present and appears earlier in the list. However, a keychain access group can be the default, because it appears before the app ID. In particular, the first keychain access group, if any, that you specify in the corresponding capability becomes the app’s default access group. If you don’t specify any keychain access groups, then the app ID is the default.</p>
<p>关于默认 group， 当添加，查询，更新，删除 keychain item 时，不指定<code>kSecAttrAccessGroup </code>时，默认操作的是哪个group ？</p>
<ol>
<li>系统以 group list 数组中的第一个为默认 group</li>
<li>默认group 不会是app group， 因为它不会是第一个</li>
<li>如果加入keychain group， 该 keychain group 可能为默认的 keychain group</li>
<li>想限定keychain item 只在 app 内访问，不能被keychain group 访问，需要将 bundle id 所在的keychain group 置顶，或者明确指定使用 bundle id 标记的keychain group</li>
</ol>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/iOS/" class="print-no-link">#iOS</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>ios keychain 总结</div>
      <div>https://yxibng.github.io/2022/11/26/ios/2022-11-26-ios keychain 总结/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>yxibng</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2022年11月26日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2022/12/21/2022-12-21-rbenv/" title="用 rbenv 来安装ruby">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">用 rbenv 来安装ruby</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/11/16/Shell/2022-11-16-%E5%91%BD%E4%BB%A4%E8%A1%8C%E9%87%8D%E5%90%AFiPhone/" title="命令行重启iPhone">
                        <span class="hidden-mobile">命令行重启iPhone</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
