

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="yxibng">
  <meta name="keywords" content="">
  
    <meta name="description" content="参考：https:&#x2F;&#x2F;cmake.org&#x2F;cmake&#x2F;help&#x2F;latest&#x2F;guide&#x2F;importing-exporting&#x2F;index.html  ImportingIMPORTED targets 将cmake工程外部的库，可执行文件引入到当前的cmake工程中，被引入的内容会关联到一个cmake 中一个逻辑上的target。 创建方式，调用add_executable(),add_lib">
<meta property="og:type" content="article">
<meta property="og:title" content="cmake Importing and Exporting Guide">
<meta property="og:url" content="https://yxibng.github.io/2022/10/24/cmake/2022-10-24-cmake%20Importing%20and%20Exporting%20Guide/index.html">
<meta property="og:site_name" content="yxibng">
<meta property="og:description" content="参考：https:&#x2F;&#x2F;cmake.org&#x2F;cmake&#x2F;help&#x2F;latest&#x2F;guide&#x2F;importing-exporting&#x2F;index.html  ImportingIMPORTED targets 将cmake工程外部的库，可执行文件引入到当前的cmake工程中，被引入的内容会关联到一个cmake 中一个逻辑上的target。 创建方式，调用add_executable(),add_lib">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-10-23T16:00:00.000Z">
<meta property="article:modified_time" content="2024-03-06T11:53:13.564Z">
<meta property="article:author" content="yxibng">
<meta property="article:tag" content="cmake">
<meta name="twitter:card" content="summary_large_image">
  
  
  
  <title>cmake Importing and Exporting Guide - yxibng</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"yxibng.github.io","root":"/","version":"1.9.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.1.1"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>yxibng</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="cmake Importing and Exporting Guide"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2022-10-24 00:00" pubdate>
          2022年10月24日 凌晨
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          1.4k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          12 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">cmake Importing and Exporting Guide</h1>
            
            
              <div class="markdown-body">
                
                <p>参考：<a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/guide/importing-exporting/index.html">https://cmake.org/cmake/help/latest/guide/importing-exporting/index.html</a> </p>
<h1 id="Importing"><a href="#Importing" class="headerlink" title="Importing"></a>Importing</h1><p>IMPORTED targets 将cmake工程外部的库，可执行文件引入到当前的cmake工程中，被引入的内容会关联到一个cmake 中一个<br>逻辑上的target。</p>
<p>创建方式，调用<code>add_executable()</code>,<code>add_library()</code>命令创建target， 但是要添加<code>IMPORTED</code>参数。</p>
<p>这个IMPORTED target不产生任何构建文件，因为他们引入的都是现成的库或者可执行文件。</p>
<p>一旦IMPORTED target 被创建好了，就可以像工程中的其他target一样被引用了。 通过这种方式，就可以方便，灵活引用外部可执行文件和库了。</p>
<h2 id="Importing-Executables"><a href="#Importing-Executables" class="headerlink" title="Importing Executables"></a>Importing Executables</h2><p>使用磁盘上的可执行文件。</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">add_executable</span><span class="hljs-params">(myexe IMPORTED)</span></span><br><span class="hljs-built_in">set_property</span>(TARGET myexe PROPERTY<br>             IMPORTED_LOCATION <span class="hljs-string">&quot;../InstallMyExe/bin/myexe&quot;</span>)<br><span class="hljs-function"><span class="hljs-title">add_custom_command</span><span class="hljs-params">(OUTPUT main.cc COMMAND myexe)</span></span><br><span class="hljs-function"><span class="hljs-title">add_executable</span><span class="hljs-params">(mynewexe main.cc)</span></span><br></code></pre></td></tr></table></figure>

<ol>
<li>创建一个IMPORTED target</li>
<li>设置target相关属性，这里指定其关联的可执行文件路径</li>
<li>添加了一个custom command， 用target myexe指定的可执行文件来生成文件<code>main.cc</code></li>
<li>创建一个正常的可执行target, 使用上一步生成的<code>main.cc</code>作为源文件</li>
</ol>
<h2 id="Importing-Libraries"><a href="#Importing-Libraries" class="headerlink" title="Importing Libraries"></a>Importing Libraries</h2><p>导入已经构建好的库作为一个target来使用。</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">add_library</span><span class="hljs-params">(foo STATIC IMPORTED)</span></span><br><span class="hljs-built_in">set_property</span>(TARGET foo PROPERTY<br>             IMPORTED_LOCATION <span class="hljs-string">&quot;/path/to/libfoo.a&quot;</span>)<br><span class="hljs-function"><span class="hljs-title">add_executable</span><span class="hljs-params">(myexe src1.c src2.c)</span></span><br><span class="hljs-function"><span class="hljs-title">target_link_libraries</span><span class="hljs-params">(myexe PRIVATE foo)</span></span><br></code></pre></td></tr></table></figure>

<ol>
<li>创建一个IMPORTED target</li>
<li>设置target相关属性，这里指定其关联的静态库路径</li>
<li>创建一个正常的可执行target myexe，链接上面创建的target foo</li>
</ol>
<p>考虑到可能会有debug，release 等不同配置，引入具有不同配置的同一个库，可以使用下面的形式</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">find_library</span><span class="hljs-params">(math_REL NAMES m)</span></span><br><span class="hljs-function"><span class="hljs-title">find_library</span><span class="hljs-params">(math_DBG NAMES md)</span></span><br><span class="hljs-function"><span class="hljs-title">add_library</span><span class="hljs-params">(math STATIC IMPORTED GLOBAL)</span></span><br><span class="hljs-built_in">set_target_properties</span>(math PROPERTIES<br>  IMPORTED_LOCATION <span class="hljs-string">&quot;$&#123;math_REL&#125;&quot;</span><br>  IMPORTED_LOCATION_DEBUG <span class="hljs-string">&quot;$&#123;math_DBG&#125;&quot;</span><br>  IMPORTED_CONFIGURATIONS <span class="hljs-string">&quot;RELEASE;DEBUG&quot;</span><br>)<br><span class="hljs-function"><span class="hljs-title">add_executable</span><span class="hljs-params">(myexe src1.c src2.c)</span></span><br><span class="hljs-function"><span class="hljs-title">target_link_libraries</span><span class="hljs-params">(myexe PRIVATE math)</span></span><br></code></pre></td></tr></table></figure>
<h1 id="Exporting-Targets"><a href="#Exporting-Targets" class="headerlink" title="Exporting Targets"></a>Exporting Targets</h1><blockquote>
<p>While IMPORTED targets on their own are useful, they still require that the project that imports them knows the locations of the target files on disk. The real power of IMPORTED targets is when the project providing the target files also provides a CMake file to help import them. A project can be setup to produce the necessary information so that it can easily be used by other CMake projects be it from a build directory, a local install or when packaged.</p>
</blockquote>
<ol>
<li>IMPORTED targets 要求使用这些target的工程，知道相关文件在磁盘上的位置。</li>
<li>要想屏蔽这些细节，库的提供方，同时提供一个导入这个库的帮助文件 <code>xxxTargets.cmake</code></li>
<li>要想生成的库，可以通过<code>find_package()</code>命令来索引使用的话，可以在cmake工程中配置，在构建工程的时候，同时生成对应的帮助文件<ul>
<li><code>xxxTargets.cmake</code></li>
<li><code>xxxConfig.cmake</code></li>
<li><code>xxxConfigVersion.cmake</code></li>
</ul>
</li>
</ol>
<h2 id="xxxTargets-cmake"><a href="#xxxTargets-cmake" class="headerlink" title="xxxTargets.cmake"></a><code>xxxTargets.cmake</code></h2><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-keyword">cmake_minimum_required</span>(VERSION <span class="hljs-number">3.15</span>)<br><span class="hljs-keyword">project</span>(MathFunctions)<br><br><span class="hljs-comment"># make cache variables for install destinations</span><br><span class="hljs-keyword">include</span>(GNUInstallDirs)<br><br><span class="hljs-comment"># specify the C++ standard</span><br><span class="hljs-keyword">set</span>(CMAKE_CXX_STANDARD <span class="hljs-number">11</span>)<br><span class="hljs-keyword">set</span>(CMAKE_CXX_STANDARD_REQUIRED <span class="hljs-keyword">True</span>)<br><br><span class="hljs-comment"># create library</span><br><span class="hljs-keyword">add_library</span>(MathFunctions STATIC MathFunctions.cxx)<br><br><span class="hljs-comment"># add include directories</span><br><span class="hljs-keyword">target_include_directories</span>(MathFunctions<br>                           PUBLIC<br>                           <span class="hljs-string">&quot;$&lt;BUILD_INTERFACE:$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;&gt;&quot;</span><br>                           <span class="hljs-string">&quot;$&lt;INSTALL_INTERFACE:$&#123;CMAKE_INSTALL_INCLUDEDIR&#125;&gt;&quot;</span><br>)<br><br><span class="hljs-comment"># install the target and create export-set</span><br><span class="hljs-keyword">install</span>(TARGETS MathFunctions<br>        <span class="hljs-keyword">EXPORT</span> MathFunctionsTargets<br>        LIBRARY DESTINATION <span class="hljs-variable">$&#123;CMAKE_INSTALL_LIBDIR&#125;</span><br>        ARCHIVE DESTINATION <span class="hljs-variable">$&#123;CMAKE_INSTALL_LIBDIR&#125;</span><br>        RUNTIME DESTINATION <span class="hljs-variable">$&#123;CMAKE_INSTALL_BINDIR&#125;</span><br>        INCLUDES DESTINATION <span class="hljs-variable">$&#123;CMAKE_INSTALL_INCLUDEDIR&#125;</span><br>)<br><br><span class="hljs-comment"># install header file</span><br><span class="hljs-keyword">install</span>(FILES MathFunctions.h DESTINATION <span class="hljs-variable">$&#123;CMAKE_INSTALL_INCLUDEDIR&#125;</span>)<br><br><span class="hljs-comment"># generate and install export file</span><br><span class="hljs-keyword">install</span>(<span class="hljs-keyword">EXPORT</span> MathFunctionsTargets<br>        <span class="hljs-keyword">FILE</span> MathFunctionsTargets.cmake<br>        NAMESPACE MathFunctions::<br>        DESTINATION <span class="hljs-variable">$&#123;CMAKE_INSTALL_LIBDIR&#125;</span>/cmake/MathFunctions<br>)<br><span class="hljs-comment"># create IMPORTED target, set target property</span><br><span class="hljs-keyword">add_library</span>(MathFunctions::MathFunctions STATIC IMPORTED)<br><span class="hljs-keyword">set_target_properties</span>(MathFunctions::MathFunctions PROPERTIES<br>  INTERFACE_INCLUDE_DIRECTORIES <span class="hljs-string">&quot;$&#123;_IMPORT_PREFIX&#125;/include&quot;</span><br>)<br></code></pre></td></tr></table></figure>

<ol>
<li>创建一个正常的静态库</li>
<li>设置静态库头文件搜索路径，分别指定构建时和安装后的路径</li>
<li>创建一个install命令，指定生成二进制文件的安装路径。其中<code>EXPORT MathFunctionsTargets</code>,指定了导出target文件对应的文件名字是<code>MathFunctionsTargets.cmake</code></li>
<li>指定头文件如何安装</li>
<li>指定<code>MathFunctionsTargets.cmake</code>文件如何安装，<code>NAMESPACE MathFunctions::</code> 给导出的target添加前缀命名空间，一般带有命名空间的target，都是<code>IMPORTED target</code></li>
<li>创建一个<code>IMPORTED target</code>,名字是<code>MathFunctions::MathFunctions</code></li>
<li>设置<code>MathFunctions::MathFunctions</code>的属性，此处是头文件路径</li>
</ol>
<p>如何使用导出的target文件, 在<code>CMakeLists.txt</code>文件中</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">include</span><span class="hljs-params">($&#123;INSTALL_PREFIX&#125;/lib/cmake/MathFunctionTargets.cmake)</span></span><br><span class="hljs-function"><span class="hljs-title">add_executable</span><span class="hljs-params">(myexe src1.c src2.c )</span></span><br><span class="hljs-function"><span class="hljs-title">target_link_libraries</span><span class="hljs-params">(myexe PRIVATE MathFunctions::MathFunctions)</span></span><br></code></pre></td></tr></table></figure>
<ol>
<li>首先包含<code>/MathFunctionTargets.cmake</code>文件</li>
<li>创建一个可执行目标myexe</li>
<li>链接MathFunctions::MathFunctions到myexe</li>
</ol>
<h2 id="支持find-package"><a href="#支持find-package" class="headerlink" title="支持find_package()"></a>支持<code>find_package()</code></h2><p>使用示例：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">find_package</span><span class="hljs-params">(Stats <span class="hljs-number">2.6</span>.<span class="hljs-number">4</span> REQUIRED)</span></span><br><span class="hljs-function"><span class="hljs-title">target_link_libraries</span><span class="hljs-params">(MathFunctions PUBLIC Stats::Types)</span></span><br></code></pre></td></tr></table></figure>

<p>find_package() 支持两种搜索模式</p>
<ul>
<li>module mode， 针对非cmake构建的库，搜索<code>Find&lt;PackageName&gt;.cmake</code>文件</li>
<li>config mode， 针对cmake构建的库，相关文件为<ul>
<li>target相关： <code>&lt;lowercasePackageName&gt;-config.cmake</code>或者<code>&lt;PackageName&gt;Config.cmake</code></li>
<li>版本相关： <code>&lt;lowercasePackageName&gt;-config-version.cmake</code> 或 <code>&lt;PackageName&gt;ConfigVersion.cmake</code></li>
</ul>
</li>
</ul>
<p>因此，cmake构建的库，想要支持<code>find_package()</code>的config模式，需要提供</p>
<ul>
<li><code>xxxConfig.cmake</code></li>
<li><code>xxConfigVersion.cmake</code></li>
</ul>
<p>首先包含<code>CMakePackageConfigHelpers</code>模块</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">include</span><span class="hljs-params">(CMakePackageConfigHelpers)</span></span><br></code></pre></td></tr></table></figure>

<h3 id="Creating-a-Package-Configuration-File"><a href="#Creating-a-Package-Configuration-File" class="headerlink" title="Creating a Package Configuration File"></a>Creating a Package Configuration File</h3><p>使用<code>CMakePackageConfigHelpers</code>模块中的<code>configure_package_config_file</code>命令来生成<code>MathFunctionsConfig.cmake</code>文件，蓝本是<code>Config.cmake.in</code>,同时指定生成后的路径。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">configure_package_config_file(<span class="hljs-variable">$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;</span>/Config.cmake.in<br>  <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;CMAKE_CURRENT_BINARY_DIR&#125;</span>/MathFunctionsConfig.cmake&quot;</span><br>  INSTALL_DESTINATION <span class="hljs-variable">$&#123;CMAKE_INSTALL_LIBDIR&#125;</span>/cmake/MathFunctions<br>)<br></code></pre></td></tr></table></figure>

<p>通过<code>isntall</code>命令指定<code>xxxConfig.cmake</code>和<code>xxxConfigVersion.cmake</code>文件安装规则</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">install(FILES<br>          <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;CMAKE_CURRENT_BINARY_DIR&#125;</span>/MathFunctionsConfig.cmake&quot;</span><br>          <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;CMAKE_CURRENT_BINARY_DIR&#125;</span>/MathFunctionsConfigVersion.cmake&quot;</span><br>        DESTINATION <span class="hljs-variable">$&#123;CMAKE_INSTALL_LIBDIR&#125;</span>/cmake/MathFunctions<br>)<br></code></pre></td></tr></table></figure>

<p>关于<code>Config.cmake.in</code>文件</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stylus">@PACKAGE_INIT@<br><br><span class="hljs-function"><span class="hljs-title">include</span><span class="hljs-params">(<span class="hljs-string">&quot;$&#123;CMAKE_CURRENT_LIST_DIR&#125;/MathFunctionsTargets.cmake&quot;</span>)</span></span><br><br><span class="hljs-function"><span class="hljs-title">check_required_components</span><span class="hljs-params">(MathFunctions)</span></span><br></code></pre></td></tr></table></figure>

<p><code>@PACKAGE_INIT@</code> 在配置的时候，会被替换和展开，展开后包含</p>
<ol>
<li>以<code>PACKAGE_</code>为前缀的相对路径</li>
<li><code>set_and_check()</code> 和 <code>heck_required_components()</code>两个宏定义。</li>
</ol>
<p><code>check_required_components</code> 针对所有的组件，给<code>&lt;Package&gt;_&lt;Component&gt;_FOUND</code>变量赋值， 找到为<code>TRUE</code>,找不到为<code>FALSE</code>。 同时给<code>&lt;Package&gt;_FOUND</code>变量赋值， 如果结果为<code>FALSE</code>,认为该package没有找到。</p>
<p><code>set_and_check</code>主要给对应的目录和文件路径赋值，如果引用的文件或路径没有找到，该宏执行失败。</p>
<h3 id="Creating-a-Package-Version-File"><a href="#Creating-a-Package-Version-File" class="headerlink" title="Creating a Package Version File"></a>Creating a Package Version File</h3><p><code>CMakePackageConfigHelpers</code>模块，提供了<code>write_basic_package_version_file()</code>命令来生成<code>xxConfigVersion.cmake</code>文件。 当<code>find_package()</code>命令指定了版本号的时候， cmake 会读取该文件来获取版本号信息做匹配</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">set(<span class="hljs-keyword">version</span> <span class="hljs-number">3.4</span>.<span class="hljs-number">1</span>)<br><br>set_property(TARGET MathFunctions <span class="hljs-keyword">PROPERTY</span><span class="hljs-title"> </span><span class="hljs-keyword">VERSION</span> $&#123;<span class="hljs-keyword">version</span>&#125;)<br>set_property(TARGET MathFunctions <span class="hljs-keyword">PROPERTY</span><span class="hljs-title"> </span>SOVERSION <span class="hljs-number">3</span>)<br>set_property(TARGET MathFunctions <span class="hljs-keyword">PROPERTY</span><span class="hljs-title"></span><br><span class="hljs-title">  </span>INTERFACE_MathFunctions_MAJOR_VERSION <span class="hljs-number">3</span>)<br>set_property(TARGET MathFunctions APPEND <span class="hljs-keyword">PROPERTY</span><span class="hljs-title"></span><br><span class="hljs-title">  </span>COMPATIBLE_INTERFACE_STRING MathFunctions_MAJOR_VERSION<br>)<br><br><span class="hljs-comment"># generate the version file for the config file</span><br>write_basic_package_version_file(<br>  <span class="hljs-string">&quot;$&#123;CMAKE_CURRENT_BINARY_DIR&#125;/MathFunctionsConfigVersion.cmake&quot;</span><br>  <span class="hljs-keyword">VERSION</span> <span class="hljs-string">&quot;$&#123;version&#125;&quot;</span><br>  COMPATIBILITY AnyNewerVersion<br>)<br></code></pre></td></tr></table></figure>

<ol>
<li>设置target的版本号相关的变量</li>
<li>将版本号信息，写入<code>MathFunctionsConfigVersion.cmake</code>文件</li>
</ol>
<p>此时已经配置好如何生成<code>xxxConfig.cmake</code>和<code>xxxConfigVersion.cmake</code>文件.<br>执行构建，安装</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">mkdir build <br><span class="hljs-keyword">cd</span> build <br>cmake <span class="hljs-string">..</span><br>cmake <span class="hljs-params">--build</span> .<br>cmake <span class="hljs-params">--install</span> . <span class="hljs-params">--prefix</span> `&lt;prefix&gt;`<br></code></pre></td></tr></table></figure>

<p>观察输出, 对应的文件已经生成</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stylus">MathFunctionsConfig<span class="hljs-selector-class">.cmake</span><br>MathFunctionsConfigVersion<span class="hljs-selector-class">.cmake</span><br>MathFunctionsTargets-noconfig<span class="hljs-selector-class">.cmake</span><br>MathFunctionsTargets.cmake<br></code></pre></td></tr></table></figure>
<p>使用<code>find_package()</code>来使用生成config文件, 此时需要通过<code>CMAKE_PREFIX_PATH</code>来指定config文件的搜罗路径。</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-built_in">cmake_minimum_required</span>(VERSION <span class="hljs-number">3.15</span>)<br><span class="hljs-built_in">project</span>(Downstream)<br><br># specify the C++ standard<br><span class="hljs-built_in">set</span>(CMAKE_CXX_STANDARD <span class="hljs-number">11</span>)<br><span class="hljs-built_in">set</span>(CMAKE_CXX_STANDARD_REQUIRED True)<br><br><span class="hljs-built_in">find_package</span>(MathFunctions <span class="hljs-number">3.4</span>.<span class="hljs-number">1</span> EXACT)<br><br><span class="hljs-built_in">add_executable</span>(myexe main.cc)<br><span class="hljs-built_in">target_link_libraries</span>(myexe PRIVATE MathFunctions::MathFunctions)<br></code></pre></td></tr></table></figure>

<p>注意：<br>导出配置，不应该引用绝对路径，应当关联相对路径，这样，无论安装在哪里，都可以通过config文件正确索引到库。</p>
<ol>
<li>不应当显示的依赖<code>CMAKE_INSTALL_PREFIX</code></li>
</ol>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs ruby">target_include_directories(tgt <span class="hljs-variable constant_">INTERFACE</span><br>  <span class="hljs-comment"># Wrong, not relocatable:</span><br>  <span class="hljs-variable">$&lt;</span><span class="hljs-variable constant_">INSTALL_INTERFACE</span><span class="hljs-symbol">:</span><span class="hljs-variable">$&#123;</span><span class="hljs-variable constant_">CMAKE_INSTALL_PREFIX</span>&#125;/<span class="hljs-keyword">include</span>/<span class="hljs-title class_">TgtName</span>&gt;<br>)<br><br>target_include_directories(tgt <span class="hljs-variable constant_">INTERFACE</span><br>  <span class="hljs-comment"># Ok, relocatable:</span><br>  <span class="hljs-variable">$&lt;</span><span class="hljs-variable constant_">INSTALL_INTERFACE</span><span class="hljs-symbol">:include/TgtName&gt;</span><br>)<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>可以使用<code>$&lt;INSTALL_PREFIX&gt; generator expression</code></li>
</ol>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs crystal">target_include_directories(tgt INTERFACE<br>  <span class="hljs-comment"># Ok, relocatable:</span><br>  <span class="hljs-variable">$&lt;</span><span class="hljs-symbol">INSTALL_INTERFACE:</span><span class="hljs-variable">$&lt;</span>INSTALL_PREFIX&gt;<span class="hljs-regexp">/include/</span>TgtName&gt;<br>)<br></code></pre></td></tr></table></figure>








                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/cmake/" class="print-no-link">#cmake</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>cmake Importing and Exporting Guide</div>
      <div>https://yxibng.github.io/2022/10/24/cmake/2022-10-24-cmake Importing and Exporting Guide/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>yxibng</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2022年10月24日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2022/10/29/c++/2022-10-29-Xcode%20%E9%85%8D%E7%BD%AE%20clang-format%20%E6%A0%BC%E5%BC%8F%E5%8C%96%20c++%20%E4%BB%A3%E7%A0%81/" title="Xcode 配置 clang-format 格式化 C++代码">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Xcode 配置 clang-format 格式化 C++代码</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/10/23/cmake/2022-10-23-cmake%20add_custom_command/" title="cmake add_custom_command">
                        <span class="hidden-mobile">cmake add_custom_command</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
